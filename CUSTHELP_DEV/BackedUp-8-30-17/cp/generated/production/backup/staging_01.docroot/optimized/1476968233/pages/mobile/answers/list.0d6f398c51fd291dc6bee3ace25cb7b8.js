
RightNow.EventProvider=RightNow.Widgets.extend({constructor:function(){this._events={};this._eventHandlers={};this._eventFilters={}},_addEventHandler:function(a,b){this._eventHandlers[a]=b;return this},_getEventHandlers:function(a){return this._eventHandlers[a]||{}},_addSubscribersFilter:function(a,b,d){if(!b||"function"!==typeof b)throw Error("Subscriber filters must be functions.");this._eventFilters[a]||(this._eventFilters[a]=[]);this._eventFilters[a].push({handler:b,context:d});return this},_getFilteredSubscriberIndices:function(a){var b=this._events[a];a=this._eventFilters[a];var d=[],c;if(a)for(var f=0;f<a.length;f++)c=a[f],c=c.handler.call(c.context,b),this.Y.Array.each(c,function(a){isNaN(a)||d.push(a)},this);return d},fire:function(a,b,d){var c=this._getEventHandlers(a),f=this._getFilteredSubscriberIndices(a),g=this._events[a],e=!0,k=[];c.pre&&(e=c.pre.call(this,b));if(!1!==e){if(g){d="undefined"!==typeof d?[b,d]:[b];for(var e=0,l=g.length,h,m;e<l;e++)-1===this.Y.Array.indexOf(f,e)&&(h=g[e],m=h.handler.call(h.context||window,a,d),h.once&&k.push(e),c.during&&c.during.call(this,m));if(l=k.length)for(e=0;e<l;e++)g.splice(k[e]-e,1)}c.post&&c.post.call(this,b)}return this},on:function(a,b,d,c){this._events[a]=this._events[a]||[];if(b&&"function"===typeof b)return this._events[a].push({handler:b,context:d,once:c}),this;throw Error("Handler specified isn't a callable function");},once:function(a,b,d){return this.on(a,b,d,!0)},detach:function(a,b,d){if(b&&"function"===typeof b){var c;if(c=this._events[a])for(a=c.length-1;0<=a;a--)c[a].handler!==b||d&&d!==c[a].context||c.splice(a,1);return this}throw Error("Handler specified isn't a callable function");}});
(function(){function r(f){function h(a,b){b=b?RightNow.Url.convertToSegment(RightNow.Url.convertToArray(1,b)):"";d.add({state:a},{url:p.getCurrentPage()+b})}function k(a){return function(){g||a.apply(this,arguments)}}var c={},e={},a={},b="",g=!1,d=new f.HistoryHTML5;d.on("change",function(a){var b;a.src===f.HistoryHTML5.SRC_POPSTATE&&(a=a.changed.state||a.changed[RightNow.Event.browserHistoryManagementKey],b=l.get(),g=!0,a?f.Object.each(a.newVal,function(a){q.ajaxCallback(a.response,a.data)}):f.Object.each(b,function(a){a.fire("reset").fire("send")}),g=!1)});return{enabled:!0,setCache:function(a,b,g){c[a]||(c[a]={});c[a][b]=g},checkCache:function(a,b){return c[a]?c[a][b]:null},restoreCache:k(function(c){f.Object.isEmpty(e)&&h(a,b+=c.friendly);b=""}),addRequest:k(function(c,g){f.Object.isEmpty(e)&&(q.searchesPerformed++,a={},b="");e[g]=c}),addResponse:k(function(c,g){var d=e[g];if(d){var k=b+=d.friendly,d=f.merge(d,c);a[g]=d;delete e[g];f.Object.isEmpty(e)&&h(a,k)}})}}var m,q,p,l;"pushState"in window.history?YUI().use("history-html5",function(f){m=r(f)}):m={enabled:!1};q=function(){function f(a,b,c){var d="undefined"===typeof c;a&&!d&&m.addResponse({response:a,data:b},c);m.setCache(b.searchSource,b.cacheKey,a);c=l.get(b.searchSource);d&&(c.once("send",function(){return!1}).fire("send",b.allFilters),a.fromHistoryManager=!0);c.fire("response",new RightNow.Event.EventObject(null,{data:a,filters:b.allFilters}))}function h(a,b,c,d){a=RightNow.Ajax.makeRequest(a,b,{successHandler:f,failureHandler:function(a){var b=RightNow.Interface.getMessage("ERROR_REQUEST_ACTION_COMPLETED_MSG");403===a.status&&void 0!==a.responseText&&(b=a.responseText);RightNow.UI.Dialog.messageDialog(b,{icon:"WARN",exitCallback:function(){window.location.reload(!0)}})},json:!0,data:c,timeout:1E4});m.addRequest(d,a.id+"")}function k(a,b,c,d){var f=["keyword"].concat(a.filters||[]),s=f.length,h,k,l={};c=RightNow.Lang.cloneObject(c);a.params&&(c=e.mix(c,a.params));if(b&&b.allFilters)for(a=0;a<s;a++)h=f[a],(k=b.allFilters[h])&&k.filters&&k.filters.data&&!c[h]&&("keyword"!==h||d||(h="kw"),l[h]=c[h]=k.filters.data);c.page&&!l.page&&(l.page=c.page);return{filtersToInclude:l,params:c}}function c(a,b){b&&1!==b||(a=RightNow.Url.addParameter(a,"search","1"));return a}var e=YUI();return{searchesPerformed:0,go:function(a,b,g,d,e){if("report"===d.type){if("undefined"===typeof b)throw Error("No search filters have been defined for report "+d.id);RightNow.Event.fire("evt_searchRequest",new RightNow.Event.EventObject(this,{filters:b}));if(!m.enabled||!0===a.newPage||a.reportPage&&!RightNow.Url.isSameUrl(a.reportPage))if(g=RightNow.Url,d=a.reportPage||p.getCurrentPage(),e=a.target||"_self",!a.page&&b.allFilters.page&&(a.page=1,b.allFilters.page=1),d=g.convertSearchFiltersToParms(d,b.allFilters,0),d=g.addParameter(d,"session",g.getSession()),d=c(d,b.allFilters.page),a.popupWindow){b=window.screenX||window.screenLeft;g=window.screenY||window.screenTop;var f;f=b+document.body.clientWidth;e=screen.width*a.width/100;a=screen.height*a.height/100;f=b>screen.width-f?b-e-15:f+15;var n=window.screenY?window.screenY:window.screenTop;0>f&&(f=b+100);0>n&&(n=g+100);window.open(d,"_blank","scrollbars=1,resizable=1,left="+f+",top="+n+",width="+e+"px,height="+a+"px")}else window.open(d,e);else a.page?delete b.allFilters.search:b.allFilters.page=1,a=d.id,d=d.type+d.id,g=p.buildReportRequestParameters(a,b.allFilters,b.format,b.token,0),e=RightNow.Url.convertSearchFiltersToParms("",b.allFilters,""),f=g.sf,1===f.page&&(f.search=1),f=RightNow.JSON.stringify(f),n=m.checkCache(d,f),e={key:d,friendly:e},n?(m.restoreCache(e),l.get(d).fire("response",new RightNow.Event.EventObject(null,{data:n,filters:b}))):h("/ci/ajaxRequest/getReportData",{filters:f,report_id:a,r_tok:g.token,format:RightNow.JSON.stringify(g.fmt)},{searchSource:d,allFilters:b,cacheKey:f},e)}else if(g&&"object"===typeof g&&d.id)if(RightNow.Event.fire("evt_searchRequest",new RightNow.Event.EventObject(this,{filters:b})),m.enabled&&!0!==a.newPage){a=e.endpoint;b=k(e,b,g,!0);g=b.filtersToInclude;b=b.params;if(!a)throw Error("An endpoint hasn't been specified");d=d.type+d.id;e=RightNow.JSON.stringify(b);f=m.checkCache(d,e);g={key:d,friendly:RightNow.Url.convertToSegment(g)};f?(m.restoreCache(g),l.get(d).fire("response",new RightNow.Event.EventObject(null,{data:f,filters:b}))):h(a,b,{searchSource:d,allFilters:b,cacheKey:e},g)}else a=RightNow.Url,d=p.getCurrentPage(),b=k(e,b,g,!1).filtersToInclude,d+=a.convertToSegment(b),d=a.addParameter(d,"session",a.getSession()),d=c(d,b.page),window.open(d,"_self")},ajaxCallback:f}}();p={buildReportRequestParameters:function(f,h,k,c,e){var a=RightNow.Lang.cloneObject(h),b;for(b in a)a.hasOwnProperty(b)&&(a[b].filters&&(a[b].filters.report_id=parseInt(f,10)),a[b].data&&delete a[b].data);k||(k={});k.urlParms=RightNow.Url.buildUrlLinkString(h,k.parmList);return{c:e,id:f,sf:a,fmt:k,token:c}},getCurrentPage:function(){var f=window.location,h=f.pathname,f=f.origin||f.protocol+"//"+f.host;return"/"===h||"/app"===h||"/app/"===h?f+"/app/"+RightNow.Interface.getConfig("CP_HOME_URL"):h.split("/").slice(0,RightNow.Url.getParameterSegment()-1).join("/")}};l=function(){function f(c){if(!c||!c.length||2>c.length)throw Error("You're doing it wrong");this.sources=c;this.multiple=!0}var h={},k=RightNow.EventProvider.extend({overrides:{constructor:function(c,e){this.parent();this.Y=c;delete this.data;delete this.baseDomID;delete this.baseSelector;this.searchSource=e;this.instanceID=e.id;this._addEventHandler("search",{pre:function(a){this._params||(this._params={});a instanceof RightNow.Event.EventObject&&(this._originalEventObject=RightNow.Lang.cloneObject(a),this._collectSearchFilters(a),this._params.newPage=a.filters.newPage)},during:function(a){a instanceof RightNow.Event.EventObject&&this._collectSearchFilters(a)},post:function(){var a,b;if(this._excludedFilters)for(a=0;a<this._excludedFilters.length;a++)b=this._excludedFilters[a],this._respondingFilters&&!this._respondingFilters[b]&&(b=this._filters.allFilters[b])&&b.filters&&(b.filters.data[0]?b.filters.data[0]=null:b.filters.data=null);this.fire("send",this._filters,this._params)}})._addEventHandler("send",{pre:function(a){this._originalEventObject||(this._originalEventObject={filters:{page:1,newPage:!1}});this._eventCancelled=!1},during:function(a){!1===a&&(this._eventCancelled=!0)},post:function(a){this._eventCancelled||(this._excludedFilters=[],q.go(this._originalEventObject.filters,this._filters,this._params,this.searchSource,this))}})._addEventHandler("setInitialFilters",{post:function(a){this._setInitialFilters(a)}})._addEventHandler("appendFilter",{post:function(a){this._originalEventObject||(this._originalEventObject=RightNow.Lang.cloneObject(a));this._mergeFilters(a)}})._addEventHandler("excludeFilterFromNextSearch",{post:function(a){this._excludedFilters||(this._excludedFilters=[]);this._excludedFilters.push(a.data.name)}})._addEventHandler("reset").on("reset",function(){var a=(this._filters=RightNow.Lang.cloneObject(this._initialFilters))?this._filters.allFilters:null;this._params&&a&&(this._initialParams&&(this._params=RightNow.Lang.cloneObject(this._initialParams)),this.Y.Object.each(this._params,function(b,c,d){a[c]&&a[c].filters&&"data"in a[c].filters&&(d[c]=a[c].filters.data)}))},this)}},_setFilters:function(c){this._filters=c},_setInitialFilters:function(c){c instanceof RightNow.Event.EventObject&&(this.Y.Object.isEmpty(c.filters)||(this._filters=c.filters,this._initialFilters=RightNow.Lang.cloneObject(c.filters)),this.Y.Object.isEmpty(c.data)||(this._params=c.data,this._initialParams=RightNow.Lang.cloneObject(c.data)))},_mergeFilters:function(c){this._filters.allFilters=this.Y.mix(this._filters.allFilters,c.filters,!0,null,0,!0)},_collectSearchFilters:function(c){c=new RightNow.Event.EventObject({instanceID:c.w_id},RightNow.Lang.cloneObject(c));c.filters.searchName?(this._respondingFilters||(this._respondingFilters={}),this._respondingFilters[c.filters.searchName]=!0,this._filters||(this._filters={}),this._filters.allFilters||(this._filters.allFilters={}),this._filters.allFilters[c.filters.searchName]=c):"generic"===this.searchSource.type&&(this._params=this.Y.mix(this._params||{},c.data,!0))}});f.prototype={_invoke:function(c,e,a,b){for(var f=0;f<this.sources.length;f++)this.sources[f][c](e,a,b);return this},on:function(c,e,a){return this._invoke("on",c,e,a)},fire:function(c,e,a){return this._invoke("fire",c,e,a)}};return{multipleSourcesWrapper:f,get:function(c){return"undefined"===typeof c?h:h[c]},add:function(c,e){if(c&&e instanceof k&&!h[c])return h[c]=e},getSearchSources:function(c,e){var a=c?(c+"").split(","):[],b=e?(e+"").split(","):[],f=[],d;for(d=0;d<a.length;d++)f.push({type:"report",id:a[d]});for(d=0;d<b.length;d++)f.push({type:"generic",id:b[d]});return{report:a,source:b,keys:f}},searchSource:k,findNamedSource:function(c,e){if(e){this.findNamedSource.findSource||(this.findNamedSource.findSource=function(a,b){if(b.multiple)for(var c=0;c<b.sources.length;c++){if(b.sources[c].instanceID===a)return b.sources[c]}else if(b.instanceID===a)return b});this.findNamedSource.warning||(this.findNamedSource.warning=function(a){RightNow.UI.DevelopmentHeader&&RightNow.UI.DevelopmentHeader.addJavascriptWarning(RightNow.Text.sprintf(RightNow.Interface.getMessage("PCT_D_SRCH_SRC_ID_RPT_ID_SRC_ID_LBL"),a))});var a=[],b=[];if("string"===typeof e||"number"===typeof e){e=(e+"").split(",");if(1<e.length){for(var g=0,d;g<e.length;g++)(d=this.findNamedSource.findSource(e[g],c))?a.push(d):b.push(e[g]);b.length&&this.findNamedSource.warning(b.join(", "));if(a.length)return 1<a.length?new f(a):a[0]}else if(a=this.findNamedSource.findSource(e[0],c))return a;!b.length&&this.findNamedSource.warning(e[0]);return c}if("object"===typeof e){for(g in e)e.hasOwnProperty(g)&&((d=this.findNamedSource.findSource(g,c))?(d=YUI().mix(d,e[g]),a.push(d)):b.push(g));b.length&&this.findNamedSource.warning(b.join(", "));if(a.length)return 1<a.length?new f(a):a[0]}}if(!c)throw Error("The widget extending from RightNow.SearchFilter doesn't have report_id or source_id attributes.");return c}}}();RightNow.SearchFilter=RightNow.Widgets.extend({constructor:function(){for(var f=l.getSearchSources(this.data.attrs.report_id,this.data.attrs.source_id),h=[],k=0,c,e;k<f.keys.length;k++)e=f.keys[k],c=l.get(e.type+e.id),c||(c=new l.searchSource(this.Y,e),l.add(e.type+e.id,c)),h.push(c);1<h.length&&(c=new l.multipleSourcesWrapper(h));this.searchSource=function(a){return l.findNamedSource(c,a)}}});RightNow.ResultsDisplay=RightNow.SearchFilter})();
RightNow.Widgets.SearchButton=RightNow.SearchFilter.extend({overrides:{constructor:function(){this.parent();this._requestInProgress=false;this._searchButton=this.Y.one(this.baseSelector+"_SubmitButton");if(this._searchButton){this._enableClickListener();this.searchSource().on("response",this._enableClickListener,this);}}},_startSearch:function(evt){if(this._requestInProgress)return;if(!this.data.attrs.popup_window&&(!this.data.attrs.report_page_url&&(this.data.attrs.target==='_self')))
this._disableClickListener();if(this.Y.UA.ie){this._parentForm=this._parentForm||this.Y.one(this.baseSelector).ancestor("form");if(this._parentForm&&window.external&&"AutoCompleteSaveForm"in window.external){window.external.AutoCompleteSaveForm(this.Y.Node.getDOMNode(this._parentForm));}}
var searchPage=this.data.attrs.report_page_url;this.searchSource().fire("search",new RightNow.Event.EventObject(this,{filters:{report_id:this.data.attrs.report_id,source_id:this.data.attrs.source_id,reportPage:searchPage,newPage:top!==self||(searchPage!==""&&searchPage!=="{current_page}"&&!RightNow.Url.isSameUrl(searchPage)),target:this.data.attrs.target,popupWindow:this.data.attrs.popup_window,width:this.data.attrs.popup_window_width_percent,height:this.data.attrs.popup_window_height_percent}}));},_enableClickListener:function(){this._requestInProgress=false;this._searchButton.on("click",this._startSearch,this);},_disableClickListener:function(){this._requestInProgress=true;this._searchButton.detach("click",this._startSearch);}});
RightNow.Widgets.KeywordText=RightNow.SearchFilter.extend({overrides:{constructor:function(){this.parent();this._textElement=this.Y.one(this.baseSelector+"_Text");this.data.js.initialValue=this._decoder(this.data.js.initialValue);if(this._textElement){this._searchedOn=this._textElement.get("value");if(this._searchedOn!==this.data.js.initialValue)
this._textElement.set("value",this.data.js.initialValue);this._setFilter();this._textElement.on("change",this._onChange,this);this.searchSource().on("keywordChanged",this._onChangedResponse,this).on("search",this._onGetFiltersRequest,this).on("reset",this._onResetRequest,this);this.searchSource(this.data.attrs.report_id).on("response",this._onChangedResponse,this);if(this.data.attrs.initial_focus)
this._textElement.focus();}}},_onChange:function(evt){this._eo.data=this._textElement.get("value");this._eo.filters.data=this._textElement.get("value");this.searchSource().fire("keywordChanged",this._eo);},_onGetFiltersRequest:function(type,args){this._eo.filters.data=this.Y.Lang.trim(this._textElement.get("value"));this._searchedOn=this._eo.filters.data;return this._eo;},_setFilter:function(){this._eo=new RightNow.Event.EventObject(this,{filters:{searchName:this.data.js.searchName,data:this.data.js.initialValue,rnSearchType:this.data.js.rnSearchType,report_id:this.data.attrs.report_id}});},_onChangedResponse:function(type,args){var data=RightNow.Event.getDataFromFiltersEventResponse(args,this.data.js.searchName),newValue=(data===null)?this.data.js.initialValue:data;newValue=this._decoder(newValue);if(this._textElement.get("value")!==newValue)
this._textElement.set("value",newValue);},_onResetRequest:function(type,args){if(!args[0]||args[0].data.name===this.data.js.searchName){this._textElement.set('value',this.data.js.initialValue);}
else if(args[0].data.name==='all'){this._textElement.set('value',this._searchedOn);}},_decoder:function(value){if(value)
return value.replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&#039;/g,"'").replace(/&quot;/g,'"');return value;}});
RightNow.Widgets.ResultInfo=RightNow.SearchFilter.extend({overrides:{constructor:function(){this.parent();this._searchSources=0;if(this.data.attrs.display_knowledgebase_results){this.searchSource(this.data.attrs.report_id).on('response',this._onReportChanged,this);}
if(this.data.attrs.combined_results){this._searchTerm=this.data.js.searchTerm;if(this.data.js.social){if(this.data.js.social){this._searchSources++;}
this.searchSource(this.data.attrs.source_id).on('response',this._reportCombinedResults,this);}
this.searchSource().on('appendFilter',function(evt,args){if(args[0].filters.page&&args[0].data){this._page=args[0].data.page;}},this);this.searchSource(this.data.attrs.report_id).on('send',this._watchSearchFilterChange,this);}
if(this.data.js.error){RightNow.UI.Dialog.messageDialog(this.data.js.error,{"icon":"WARN"});}}},_onReportChanged:function(type,args)
{var newData=args[0].data,resultQuery="",parameterList=(this.data.attrs.add_params_to_url)?RightNow.Url.buildUrlLinkString(args[0].filters.allFilters,this.data.attrs.add_params_to_url):'';this._determineNewResults(args[0]);if(!this.data.attrs.combined_results&&this.data.attrs.display_results&&newData.search_term)
{var stopWords=newData.stopword,noDictWords=newData.not_dict,searchTerms=newData.search_term.split(" "),displayedNoResultsMsg=false;for(var i=0,word,strippedWord;i<searchTerms.length;i++)
{word=searchTerms[i];strippedWord=word.replace(/\W/,"");if(stopWords&&strippedWord&&stopWords.indexOf(strippedWord)!==-1)
word="<span class='rn_Strike' title='"+this.data.attrs.label_common+"'>"+word+"</span>";else if(noDictWords&&strippedWord&&noDictWords.indexOf(strippedWord)!==-1)
word="<span class='rn_Strike' title='"+this.data.attrs.label_dictionary+"'>"+word+"</span>";else
word="<a href='"+RightNow.Url.addParameter(this.data.js.linkUrl+encodeURIComponent(word.replace(/\&amp;/g,"&"))+parameterList+"/search/1","session",RightNow.Url.getSession())+"'>"+word+"</a>";resultQuery+=word+" ";}
resultQuery=this.Y.Lang.trim(resultQuery);}
var suggestedDiv=this.Y.one(this.baseSelector+"_Suggestion");if(suggestedDiv)
{if(newData.ss_data)
{var links=this.data.attrs.label_suggestion+" ";for(var i=0;i<newData.ss_data.length;i++)
links+='<a href="'+this.data.js.linkUrl+newData.ss_data[i]+'/suggested/1'+parameterList+'">'+newData.ss_data[i]+'</a>&nbsp;';suggestedDiv.set('innerHTML',links).removeClass('rn_Hidden');}
else
{RightNow.UI.hide(suggestedDiv);}}
var spellingDiv=this.Y.one(this.baseSelector+"_Spell");if(spellingDiv)
{if(newData.spelling)
{spellingDiv.set('innerHTML',this.data.attrs.label_spell+' <a href="'+this.data.js.linkUrl+newData.spelling+'/dym/1/'+parameterList+'">'+newData.spelling+' </a>').removeClass('rn_Hidden');}
else
{RightNow.UI.hide(spellingDiv);}}
this._updateSearchResults({searchTermToDisplay:resultQuery,userSearchedOn:newData.search_term,topics:newData.topics,truncated:newData.truncated});if(!this.data.attrs.combined_results)
{this.data.js.totalResults=0;this.data.js.firstResult=0;this.data.js.lastResult=0;}},_updateSearchResults:function(options)
{options=options||{};var noResultsDiv=this.Y.one(this.baseSelector+"_NoResults"),resultsDiv=this.Y.one(this.baseSelector+"_Results"),searchTermToDisplay=options.searchTermToDisplay,displayedNoResultsMsg=false;if(noResultsDiv)
{if(this.data.js.totalResults===0&&options.userSearchedOn&&(!options.topics||options.topics.length===0))
{noResultsDiv.set('innerHTML',this.data.attrs.label_no_results+"<br/><br/>"+this.data.attrs.label_no_results_suggestions).removeClass('rn_Hidden');displayedNoResultsMsg=true;}
else
{RightNow.UI.hide(noResultsDiv);}}
if(resultsDiv)
{if(!displayedNoResultsMsg&&!options.truncated)
{resultsDiv.set('innerHTML',(searchTermToDisplay&&searchTermToDisplay.length>0)?RightNow.Text.sprintf(this.data.attrs.label_results_search_query,this.data.js.firstResult,this.data.js.lastResult,this.data.js.totalResults,searchTermToDisplay):RightNow.Text.sprintf(this.data.attrs.label_results,this.data.js.firstResult,this.data.js.lastResult,this.data.js.totalResults));RightNow.UI.show(resultsDiv);}
else
{RightNow.UI.hide(resultsDiv);}}},_determineNewResults:function(eventObject){var reportData=eventObject.data;if(this.data.attrs.combined_results){if(this.data.js.totalResults===0||this.data.js.totalResults===this.data.js.combinedResults){this.data.js.totalResults+=reportData.total_num;}
if(typeof reportData.pruned==="number"){this.data.js.totalResults-=reportData.pruned;}
if(typeof this.data.js.prunedAnswers==="number"&&!reportData.pruned){reportData.start_num-=this.data.js.prunedAnswers;reportData.end_num-=this.data.js.prunedAnswers;reportData.pruned=true;}}
else{this.data.js.totalResults=reportData.total_num;}
this.data.js.firstResult=reportData.start_num;if(reportData.page!==1){this.data.js.firstResult+=this.data.js.combinedResults;}
if(this.data.js.firstResult===0&&this.data.js.combinedResults!==0){this.data.js.firstResult=1;}
this.data.js.lastResult=reportData.end_num+this.data.js.combinedResults;this._page=reportData.page;if(reportData.pruned&&eventObject.w_id&&eventObject.w_id.indexOf("CombinedSearchResults")>-1){this.data.js.prunedAnswers=(this.data.js.prunedAnswers===reportData.pruned)?false:reportData.pruned;}},_reportCombinedResults:function(evt,args){args=args[0];if(!args.data)return;var newTotal=0,argData=args.data,jsData=this.data.js;if(jsData.social&&argData.social){newTotal+=Math.min(argData.social.data.totalResults,20)||0;}
if(!this._page||this._page<2){jsData.combinedResults+=newTotal;jsData.lastResult+=newTotal;jsData.totalResults+=newTotal;jsData.firstResult=((jsData.combinedResults)?1:0);if(jsData.totalResults===0||this.data.js.combinedResults>0){this._updateSearchResults({userSearchedOn:true});}}},_watchSearchFilterChange:function(evt,args){args=args[0];if(!args)return;var filters=args.allFilters;if(filters&&((filters.keyword&&filters.keyword.filters.data!==this._searchTerm)||(filters.page===1))){this._page=1;this._searchTerm=filters.keyword.filters.data;this.data.js.totalResults=0;this.data.js.combinedResults=0;this.data.js.lastResult=0;this.data.js.firstResult=0;this.data.js.prunedAnswers=false;}}});
RightNow.Widgets.Paginator=RightNow.SearchFilter.extend({overrides:{constructor:function(){this.parent();this._currentPage=this.data.js.currentPage;for(var i=this.data.js.startPage;i<=this.data.js.endPage;i++)
{var pageLinkID=this.baseSelector+"_PageLink_"+i;if(this.Y.one(pageLinkID))
this.Y.one(pageLinkID).on("click",this._onPageChange,this,i);}
this._instanceElement=this.Y.one(this.baseSelector);this._forwardButton=this.Y.one(this.baseSelector+"_Forward");this._forwardButton.on("click",this._onDirection,this,true);this._backButton=this.Y.one(this.baseSelector+"_Back");this._backButton.on("click",this._onDirection,this,false);this._eo=new RightNow.Event.EventObject(this,{filters:{report_id:this.data.attrs.report_id,per_page:this.data.attrs.per_page,page:this._currentPage}});this.searchSource(this.data.attrs.report_id).on("response",this._onReportChanged,this);}},_onPageChange:function(evt,pageNumber)
{evt.preventDefault();if(this._currentlyChangingPage||!pageNumber||pageNumber===this._currentPage)
return;this._currentlyChangingPage=true;pageNumber=(pageNumber<1)?1:pageNumber;this._eo.filters.page=this._currentPage=pageNumber;if(RightNow.Event.fire("evt_switchPagesRequest",this._eo)){this.searchSource().fire("appendFilter",this._eo).fire("search",this._eo);}},_onDirection:function(evt,isForward)
{evt.preventDefault();if(this._currentlyChangingPage)
return;this._currentlyChangingPage=true;if(isForward)
this._currentPage++;else
this._currentPage--;this._eo.filters.page=this._currentPage;if(RightNow.Event.fire("evt_switchPagesRequest",this._eo)){this.searchSource().fire("appendFilter",this._eo).fire("search",this._eo);}},_onReportChanged:function(type,args)
{var newData=args[0];newData=newData.data;if(args[0].filters.report_id==this.data.attrs.report_id)
{this._currentPage=newData.page;var totalPages=newData.total_pages;if(totalPages<2||newData.truncated)
{RightNow.UI.hide(this._instanceElement);}
else
{var pagesContainer=this.Y.one(this.baseSelector+"_Pages");if(pagesContainer)
{pagesContainer.set('innerHTML',"");var startPage,endPage;if(this.data.attrs.maximum_page_links===0)
startPage=endPage=this._currentPage;else if(totalPages>this.data.attrs.maximum_page_links)
{var split=Math.round(this.data.attrs.maximum_page_links/2);if(this._currentPage<=split)
{startPage=1;endPage=this.data.attrs.maximum_page_links;}
else
{var offsetFromMiddle=this._currentPage-split;var maxOffset=offsetFromMiddle+this.data.attrs.maximum_page_links;if(maxOffset<=newData.total_pages)
{startPage=1+offsetFromMiddle;endPage=maxOffset;}
else
{startPage=newData.total_pages-(this.data.attrs.maximum_page_links-1);endPage=newData.total_pages;}}}
else
{startPage=1;endPage=totalPages;}
for(var i=startPage,link,titleString;i<=endPage;i++)
{if(i===this._currentPage)
{link=this.Y.Node.create("<span/>").addClass("rn_CurrentPage").set('innerHTML',i);}
else
{link=this.Y.Node.create("<a/>").set('id',this.baseSelector+"_PageLink_"+i).set('href',this.data.js.pageUrl+i).set('innerHTML',i+'<span class="rn_ScreenReaderOnly">'+RightNow.Text.sprintf(this.data.attrs.label_page,i,totalPages)+'</span>');titleString=this.data.attrs.label_page;if(titleString)
{titleString=titleString.replace(/%s/,i).replace(/%s/,newData.total_pages);link.set('title',titleString);}}
pagesContainer.appendChild(link);link.on("click",this._onPageChange,this,i);}
RightNow.UI.show(this._instanceElement);}}
if(this._forwardButton)
{if(newData.total_pages>newData.page)
this._forwardButton.removeClass("rn_Hidden").set('href',this.data.js.pageUrl+(this._currentPage+1));else
RightNow.UI.hide(this._forwardButton);}
if(this._backButton)
{if(newData.page>1)
this._backButton.removeClass("rn_Hidden").set('href',this.data.js.pageUrl+(this._currentPage-1));else
RightNow.UI.hide(this._backButton);}}
this._currentlyChangingPage=false;}});
RightNow.Widgets.Accordion=RightNow.Widgets.extend({constructor:function(){var toggle=this.Y.one('#'+this.data.attrs.toggle);this._itemToToggle=this.Y.one('#'+this.data.attrs.item_to_toggle);if(toggle){if(!this._itemToToggle){var current=toggle.next();if(current)
this._itemToToggle=current;else
return;}
this._currentlyShowing=toggle.hasClass(this.data.attrs.expanded_css_class)||this._itemToToggle.getComputedStyle("display")!=="none";this._screenReaderMessageCarrier=toggle.appendChild(this.Y.Node.create("<img style='opacity: 0;' src='/euf/core/static/whitePixel.png' alt='"+
(this._currentlyShowing?this.data.attrs.label_expanded:this.data.attrs.label_collapsed)+"'/>"));toggle.on("click",this._onClick,this);}},_onClick:function(clickEvent){var focusItem=(this.data.attrs.focus_item_on_open_selector)?this._itemToToggle.all(this.data.attrs.focus_item_on_open_selector).item(0):null,target=clickEvent.target,cssClassToAdd,cssClassToRemove;if(this._currentlyShowing){cssClassToAdd=this.data.attrs.collapsed_css_class;cssClassToRemove=this.data.attrs.expanded_css_class;this._itemToToggle.setStyle("display","none");this._screenReaderMessageCarrier.set("alt",this.data.attrs.label_collapsed);}
else{cssClassToAdd=this.data.attrs.expanded_css_class;cssClassToRemove=this.data.attrs.collapsed_css_class;this._itemToToggle.setStyle("display","block");this._screenReaderMessageCarrier.set("alt",this.data.attrs.label_expanded);}
if(target){target.addClass(cssClassToAdd).removeClass(cssClassToRemove);}
this._currentlyShowing=!this._currentlyShowing;if(this._currentlyShowing&&focusItem){focusItem.focus();}}});
RightNow.Widgets.MobileMultiline=RightNow.ResultsDisplay.extend({overrides:{constructor:function(){this.parent();this._contentDiv=this.Y.one(this.baseSelector+"_Content");this._loadingDiv=this.Y.one(this.baseSelector+"_Loading");(RightNow.Event.isHistoryManagerFragment()&&this._setLoading(true));this.searchSource().on("response",this._onReportChanged,this).on("send",this._searchInProgress,this);this._setFilter();}},_setFilter:function(){var eo=new RightNow.Event.EventObject(this,{filters:{token:this.data.js.r_tok,format:this.data.js.format,report_id:this.data.attrs.report_id,allFilters:this.data.js.filters}});eo.filters.format.parmList=this.data.attrs.add_params_to_url;this.searchSource().fire("setInitialFilters",eo);},_searchInProgress:function(){this._setLoading(true);document.activeElement.blur();},_setLoading:function(loading){if(this._contentDiv&&this._loadingDiv){var method,toOpacity,ariaBusy;if(loading){ariaBusy=true;method="addClass";toOpacity=0;this._contentDiv.setStyle("height",this._contentDiv.get("offsetHeight")+"px");}
else{ariaBusy=false;method="removeClass";toOpacity=1;this._contentDiv.setStyle("height","auto");}
document.body.setAttribute("aria-busy",ariaBusy+"");this._contentDiv.transition({opacity:toOpacity,duration:0.4});this._loadingDiv[method]("rn_Loading");}},_onReportChanged:function(type,args){var newdata=args[0].data,ariaLabel,firstLink,newContent="";if(!this._contentDiv)return;if(newdata.total_num>0){ariaLabel=this.data.attrs.label_screen_reader_search_success_alert;newdata.hide_empty_columns=this.data.attrs.hide_empty_columns;newContent=new EJS({text:this.getStatic().templates.view}).render(newdata);}
else{ariaLabel=this.data.attrs.label_screen_reader_search_no_results_alert;}
this._updateAriaAlert(ariaLabel);this._contentDiv.set("innerHTML",newContent);if(this.data.attrs.hide_when_no_results){this.Y.one(this.baseSelector)[((newContent)?'removeClass':'addClass')]('rn_Hidden');}
this._setLoading(false);RightNow.Url.transformLinks(this._contentDiv);if(newdata.total_num&&(firstLink=this._contentDiv.one('a'))){firstLink.focus();this._topCoordinate||(this._topCoordinate=this.Y.one(this.baseSelector).getY()-20);window.scrollTo(0,this._topCoordinate);}},_updateAriaAlert:function(text){if(!text)return;this._ariaAlert=this._ariaAlert||this.Y.one(this.baseSelector+"_Alert");if(this._ariaAlert){this._ariaAlert.set("innerHTML",text);}}});
RightNow.Widgets.MobileProductCategorySearchFilter=RightNow.SearchFilter.extend({overrides:{constructor:function(){this.parent();this._selections=[];this._currentLevel=1;this._currentScreenIndex=1;this._baseID=this.baseSelector+"_"+this.data.attrs.filter_type;this.Y.Event.attach("click",this._openDialog,this._baseID+"_Launch",this);this.Y.Event.attach("click",function(){this._clearSelection();if(this.data.js.linkingOn&&this.data.attrs.filter_type==="Product"){RightNow.Event.fire("evt_menuFilterRequest",this._updateEventObject({data:{level:this._currentLevel,value:-1}}));}},this._baseID+"_FilterRemove",this);if(this.data.js.initial){this._somethingWasSelected=true;for(var i=0;i<this.data.js.initial.length;i++){this._selections.push({value:this.data.js.initial[i].id,label:this.Y.Escape.html(this.data.js.initial[i].label)});}
this._commitSelection(this._selections);}
RightNow.Event.subscribe("evt_menuFilterGetResponse",this._getSubLevelResponse,this);this.searchSource(this.data.attrs.report_id).on("search",this._onSearch,this).on("response",this._onReportResponse,this);}},_openDialog:function(){(this._dialog||this._createDialog());this._dialog.show();},_createDialog:function(element){element||(element=this.Y.one(this._baseID+"_Level1Input"));if(!element)return;this._dialog=RightNow.UI.Dialog.actionDialog(this.data.attrs.label_prompt,element,{navButtons:true,cssClass:"rn_MobileProductCategorySearchFilter"});this._dialog.backEvent.subscribe(function(){this._currentLevel=Math.max(this._currentLevel-1,1);this._currentScreenIndex=Math.max(this._currentScreenIndex-1,1);},this,true);this._dialog.hideEvent.subscribe(function(){if(this._currentLevel===1&&!this._somethingWasSelected&&this._selections.length){this._clearSelection();if(this.data.js.linkingOn&&this.data.attrs.filter_type==="Product"){RightNow.Event.fire("evt_menuFilterRequest",this._updateEventObject({data:{level:this._currentLevel,value:-1}}));}}},this,true);element.removeClass("rn_Hidden").delegate("click",this._getSubLevelRequest,"input",this);},_selectionAllMade:function(parentSelected){this._selectionMade(parentSelected);if(this.data.js.linkingOn&&this.data.attrs.filter_type==="Product"){this._currentScreenIndex--;RightNow.Event.fire("evt_menuFilterRequest",this._eo);}},_selectionMade:function(parentSelected){if(this._selections.length===0)return;var index=0,filterDiv=this.Y.one(this._baseID+"_Filters"),eventData=[],eventReconstructData=[];if(filterDiv){if(parentSelected){while(parentSelected!==this._selections[this._selections.length-1].value){this._selections.pop();}
this._currentValue=this._selections[this._selections.length-1].value;this._currentLevel=this._selections.length;}
filterDiv.set("innerHTML","");var anchor,urlParams="",selected,page=this.data.js.searchPage+this.data.js.searchName+'/';do{if(this._selections[index].value){selected=((index===this._selections.length-1)?" rn_Selected":"");anchor=this.Y.Node.create("<a href='"+((!selected)?page+this._selections[index].value:'javascript:void(0);')+"'>"+this._selections[index].label+"</a>");anchor.set("className","rn_FilterItem"+selected);filterDiv.append(anchor);urlParams+=this._selections[index].value+",";eventReconstructData.push({value:this._selections[index].value,label:this._selections[index].label,url:urlParams});eventData.push(this._selections[index].value);}
index++;}
while(index<this._currentLevel&&this._selections[index]);}
this._somethingWasSelected=true;(this._dialog&&this._dialog.hide());this.Y.one(this._baseID+"_FilterRemove")[(this._selections[0].value)?"removeClass":"addClass"]("rn_Hidden");this._markSelectionInDialog();this._commitSelection(this._selections);this._updateEventObject({data:{level:this._currentLevel,value:this._currentValue},filters:{data:{0:eventData,reconstructData:eventReconstructData}}});this._eo.data.hierChain=this._getCommittedSelection(true);RightNow.Event.fire("evt_productCategoryFilterSelected",this._eo);delete this._eo.data.hierChain;if(this.data.attrs.search_on_select){this._eo.filters.reportPage=this.data.attrs.report_page_url;this.searchSource().fire("search",this._eo);}},_clearSelection:function(){this._selections=[{"value":0}];if(this._dialog){while(this._dialog.hasPreviousContent()){this._dialog.previousScreen();}}
this._currentLevel=1;this._currentScreenIndex=1;this._currentValue=0;this._selectionMade();},_markSelectionInDialog:function(deselectAll){if(deselectAll){deselectAll.all("div").removeClass("rn_Selected");}
else{if(this._dialog&&this._dialog._panel&&this._dialog._panel.id){this.Y.one("#"+this._dialog._panel.id).all("div.rn_Selected").removeClass("rn_Selected");}
for(var i=0,currentValue,currentNode,length=this._selections.length+1,markSelection=(this._selections[0]&&this._selections[0].value),apply=function(node){node.removeClass("rn_Selected");if(markSelection&&parseInt(node.one("input").get("value"),10)===currentValue){node.addClass("rn_Selected");}};i<length;i++){currentValue=(this._selections[i])?this._selections[i].value:this._selections[this._selections.length-1].value;currentNode=this.Y.one(this._baseID+"_Level"+(i+1)+"Input"+((i===0)?"":"_"+this._selections[i-1].value));if(currentNode){currentNode.all("div").each(apply);}}}},_getSubLevelRequest:function(clickEvent){if(!this._beingSelected){this._toggleLoadingIcon(clickEvent.target);var input=clickEvent.target,label=input.next("label"),hasChildren;if(label&&label.get("innerHTML")){hasChildren=label.hasClass("rn_HasChildren");this._currentLabel=this.Y.Lang.trim(label.get("childNodes").item(0).get("text"));}
this._currentValue=parseInt(input.get("value"),10);this._selections=this._selections.slice(0,this._currentScreenIndex-1);this._selections.push({value:this._currentValue,label:this.Y.Escape.html(this._currentLabel)});this._currentLevel=this._selections.length;if(this.data.js.linkingOn&&this.data.attrs.filter_type==="Product"){this._currentValue=this._currentValue||-1;this._backButtonLabel=(this._currentLevel===1)?this.data.attrs.label_filter_type:this._selections[this._currentLevel-2].label;RightNow.Event.fire("evt_menuFilterRequest",this._updateEventObject({data:{level:this._currentLevel,value:this._currentValue}}));if(!hasChildren){this._selectionMade();}
this._toggleLoadingIcon(clickEvent.target);return;}
if(!hasChildren){this._selectionMade();this._toggleLoadingIcon();}
else if(this._currentValue){this._backButtonLabel=(this._currentLevel===1)?this.data.attrs.label_filter_type:this._selections[this._currentLevel-2].label;RightNow.Event.fire("evt_menuFilterRequest",this._updateEventObject({data:{level:this._currentLevel,value:this._currentValue}}));if(this._eo.data.link_map)
delete this._eo.data.link_map;}}},_buildDialogContent:function(data,level){if(data.length&&level<7&&this._dialog){var id=this._baseID+"_Level"+level+"Input_"+this._currentValue,existingElement=this.Y.one(id);this._currentScreenIndex++;if(existingElement){var committedSelections=this._getCommittedSelection();var isSameSelection=false;for(var i in committedSelections){if(committedSelections[i].value===this._currentValue){isSameSelection=true;break;}}
if(!isSameSelection&&!(committedSelections.length+1===this._currentLevel&&committedSelections[committedSelections.length-1].value===this._currentValue)){this._markSelectionInDialog(existingElement);}
this._dialog.showScreen(id);}
else{data.unshift({id:this._currentValue,label:RightNow.Text.sprintf(RightNow.Interface.getMessage("ALL_PCT_S_LBL"),this._currentLabel)});var currentSelections=this._getCommittedSelection(),alreadySelected=(currentSelections[level-1])?currentSelections[level-1].value:(currentSelections[level-2]?currentSelections[level-2].value:false),form=new EJS({text:this.getStatic().templates.view}).render({inputID:id.substr(1),labelID:(this._baseID+"_Level"+level+"Label_"+this._currentValue).substr(1),level:level,data:data,alreadySelected:alreadySelected,parentAlt:this.data.attrs.label_parent_menu_alt,escapeHtml:this.Y.Escape.html});this._dialog.nextScreen(form,null,this._backButtonLabel);var allItem=this.Y.one(id).one('input');this.Y.one(id).delegate("click",function(e){if(e.target.compareTo(allItem)){this._selectionAllMade(data[0].id);}
else{this._getSubLevelRequest(e);}},"input",this);}}},_buildLinkedCategoryContent:function(level,data,selectedItem){var id=this._baseID+"_Level1Input",firstLevelItems=document.getElementById(id.substr(1)),element;if(this._dialog&&firstLevelItems){firstLevelItems=this.Y.one(firstLevelItems);element=firstLevelItems.next();while(element){this._dialog.previousScreen();element.remove();element=firstLevelItems.next();}
firstLevelItems.remove();}
data.unshift({id:0,label:RightNow.Text.sprintf(this.data.attrs.label_all_values,this._currentLabel)});firstLevelItems=this.Y.Node.create(new EJS({text:this.getStatic().templates.view}).render({inputID:id.substr(1),labelID:(this._baseID+"_Level"+level+"Label_"+this._currentValue).substr(1),level:level,data:data,alreadySelected:selectedItem,parentAlt:this.data.attrs.label_parent_menu_alt,escapeHtml:this.Y.Escape.html}));this._createDialog(firstLevelItems);return firstLevelItems;},_getSubLevelResponse:function(type,args){var evtObj=args[0];if((evtObj.w_id&&evtObj.w_id===this.instanceID)||(this.data.js.linkingOn&&evtObj.data.data_type==="Category"&&this.data.attrs.filter_type===evtObj.data.data_type)){if(evtObj.data.reset_linked_category){if(this.data.js.linkMap)
delete this.data.js.linkMap;if(!evtObj.data.hier_data.length){this._clearSelection();this.Y.one(this.baseSelector).setStyle("visibility","hidden");}
else{if(this._selections.length){var currentSelections=this._selections.slice(0),currentIndex=0;for(var i=0,firstItem=this._selections[0].value,newData=evtObj.data.hier_data,stillSelected;i<newData.length;i++){if(newData[i].id===firstItem){stillSelected=firstItem;break;}}
if(!stillSelected){this._clearSelection();this._buildLinkedCategoryContent(1,evtObj.data.hier_data,stillSelected);}
else{var firstLevelItems=this._buildLinkedCategoryContent(1,evtObj.data.hier_data,stillSelected),baseID=this._baseID,thisY=this.Y,firstSelectedNode=firstLevelItems.one("input[value='"+firstItem+"']"),followTree=function(input){if(!input)
return;currentIndex++;var thisRoot=baseID+"_Level"+currentIndex+"Input_"+currentSelections[currentIndex-2].value,thisRootNode=thisY.one(thisRoot),selectedNode;if(currentIndex>currentSelections.length){if(thisRootNode&&(selectedNode=thisRootNode.one("input[value='"+currentSelections[currentIndex-2].value+"']")))
selectedNode.getDOMNode().click();return;}
if(thisRootNode&&(selectedNode=thisRootNode.one("input[value='"+currentSelections[currentIndex-2].value+"']")))
selectedNode.getDOMNode().click();if(thisRootNode&&(selectedNode=thisRootNode.one("input[value='"+currentSelections[currentIndex-1].value+"']"))){selectedNode.getDOMNode().click();followTree(selectedNode);}};if(firstSelectedNode){currentIndex++;firstSelectedNode.getDOMNode().click();followTree(firstSelectedNode);}}}
else{this._buildLinkedCategoryContent(1,evtObj.data.hier_data);}
this.Y.one(this.baseSelector).setStyle("visibility","visible");}
return;}
this._currentLevel=(evtObj.data.hier_data.length)?evtObj.data.level:this._currentLevel;if(evtObj.data.hier_data.length===0)
this._selectionMade();else
this._buildDialogContent(evtObj.data.hier_data,this._currentLevel);this._toggleLoadingIcon();}},_commitSelection:function(selection){this._committedSelection=RightNow.Lang.cloneObject(selection);},_getCommittedSelection:function(justValues){if(justValues&&this._committedSelection){for(var i=0,values=[];i<this._committedSelection.length;i++){values.push(this._committedSelection[i].value);}
return values;}
return this._committedSelection||[];},_onReportResponse:function(type,args){var reportData=RightNow.Event.getDataFromFiltersEventResponse(args,this.data.js.searchName,this.data.attrs.report_id);if(reportData.reconstructData&&reportData.reconstructData.length&&!this._eventObjectCreated()){this._selections=[];for(var i=0,data=reportData.reconstructData,length=data.length;i<length;i++){this._selections.push({value:data[i].value,label:data[i].label});}
this._currentLevel=this._selections.length;this._selectionMade();this._currentValue=this._selections[this._selections.length-1].value;}
else if(!reportData[0]&&this._selections.length){this._clearSelection();this._currentValue=0;}
if(this.data.js.linkingOn&&this.data.attrs.filter_type==="Product"&&typeof this._currentValue!=="undefined"){RightNow.Event.fire("evt_menuFilterRequest",this._updateEventObject({data:{level:this._currentLevel,value:this._currentValue||-1}}));}},_onSearch:function(){return this._updateEventObject();},_updateEventObject:function(options){var widgetData=this.data.js;if(!this._initialized){this._eo=new RightNow.Event.EventObject(this,{data:{cache:[],hm_type:widgetData.hm_type,data_type:this.data.attrs.filter_type,linking_on:widgetData.linkingOn,linkingProduct:0},filters:{rnSearchType:"menufilter",searchName:widgetData.searchName,report_id:this.data.attrs.report_id,fltr_id:widgetData.fltr_id,oper_id:widgetData.oper_id,data:[]}});if(widgetData.initial){for(var i=0,length=widgetData.initial.length,initialVals=[];i<length;i++){initialVals.push(widgetData.initial[i].id);}
this._eo.filters.data[0]=initialVals;}
else{this._eo.filters.data[0]=[];}
this._updateEventObject._updateVals=function(origArray,properties){for(var i in properties){if(properties.hasOwnProperty(i)){origArray[i]=properties[i];}}};this._initialized=true;}
if(options){if(options.data){this._updateEventObject._updateVals(this._eo.data,options.data);}
if(options.filters&&options.filters.data){this._updateEventObject._updateVals(this._eo.filters.data,options.filters.data);}}
if(widgetData.linkMap){this._eo.data.link_map=widgetData.linkMap;delete widgetData.linkMap;}
return this._eo;},_eventObjectCreated:function(){return this._initialized;},_toggleLoadingIcon:function(toggleNode){if(toggleNode&&!toggleNode.hasClass('rn_LoadingIcon')){this._beingSelected=true;this.Y.one(toggleNode).next().addClass('rn_LoadingIcon');}
else{this._beingSelected=false;var existingLoadingIcon=this.Y.one('.rn_MobileProductCategorySearchFilter .rn_LoadingIcon');if(existingLoadingIcon){existingLoadingIcon.removeClass('rn_LoadingIcon');}}}});