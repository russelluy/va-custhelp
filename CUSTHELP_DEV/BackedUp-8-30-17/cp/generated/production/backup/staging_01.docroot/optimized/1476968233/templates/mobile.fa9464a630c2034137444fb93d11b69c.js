
RightNow.Widgets.LogoutLink=RightNow.Widgets.extend({constructor:function(){var logoutLink=this.Y.one(this.baseSelector+"_LogoutLink");if(!logoutLink)
return;logoutLink.on("click",this._onLogoutClick,this);},_onLogoutCompleted:function(response,originalEventObj){if(!RightNow.Event.fire("evt_logoutResponse",{data:originalEventObj,response:response}))
return;var Url=RightNow.Url;if(response.success===1&&!RightNow.UI.Form.logoutInProgress&&originalEventObj.w_id===this.instanceID)
{RightNow.UI.Form.logoutInProgress=true;if(this.data.js&&this.data.js.redirectLocation)
{if(response.session)
this.data.js.redirectLocation=Url.addParameter(this.data.js.redirectLocation,'session',RightNow.Text.getSubstringAfter(response.session,'session/'));Url.navigate(this.data.js.redirectLocation,true);}
else
{if(response.socialLogout)
Url.navigate(response.socialLogout,true);else if(this.data.attrs.redirect_url==='')
Url.navigate(response.url,true);else
Url.navigate(this.data.attrs.redirect_url+response.session,true);}}},_onLogoutClick:function(){var eventObject=new RightNow.Event.EventObject(this,{data:{w_id:this.instanceID,currentUrl:window.location.pathname,redirectUrl:this.data.attrs.redirect_url}});if(RightNow.Event.fire("evt_logoutRequest",eventObject)){RightNow.Ajax.makeRequest(this.data.attrs.logout_ajax,eventObject.data,{successHandler:this._onLogoutCompleted,scope:this,data:eventObject,json:true});}}});
RightNow.Widgets.MobileNavigationMenu=RightNow.Widgets.extend({constructor:function(){this._currentlyShowing=false;this._submenu=this.Y.one("#"+this.data.attrs.submenu);if(this._submenu){this._button=this.Y.one(this.baseSelector+"_Link");this._button.on("click",this._onClick,this);RightNow.Event.subscribe("evt_navigationMenuShow",function(evt,args){if(args[0].w_id!==this.instanceID&&this._currentlyShowing){this._onClick(null,true);}},this);this._eo=new RightNow.Event.EventObject(this);}
else{RightNow.UI.addDevelopmentHeaderError('Element specified by submenu attribute does not exist.');}},_onClick:function(clickEvent,closeAll){this._initMenu();if(this._subMenuShowing){for(var i=0;i<this._contentStack.length;i++){this._contentStack[i].setStyle("display","none");}
this._submenu.setStyle("display","block");this._button.set("innerHTML",this.data.attrs.label_button);this._subMenuShowing=false;if(!closeAll)return;}
var cssFunction,displayProperty;if(this._currentlyShowing){cssFunction="removeClass";displayProperty="none";}
else{displayProperty="block";cssFunction="addClass";RightNow.Event.fire("evt_navigationMenuShow",this._eo);var panelTop=parseInt(this._submenu.getStyle("top"),10),buttonBottom=parseInt(this._button.get("offsetHeight"),10)+parseInt(this._button.get("offsetTop"),10);if(Math.abs(panelTop-buttonBottom)>5){this._submenu.setStyle("top",(buttonBottom+5)+"px");}
if(this._firstInput){this._firstInput.focus();}}
this._currentlyShowing=!this._currentlyShowing;this._panel.setStyle("display",displayProperty);this._button[cssFunction](this.data.attrs.css_class);},_toggleMenu:function(evt,itemToToggle){if(!itemToToggle.get("id")){this._idGenerator=this._idGenerator||1;itemToToggle.set("id",this.baseDomID+"_SubMenu"+this._idGenerator);this._idGenerator++;}
this._submenu.setStyle("display","none");this._panel.appendChild(itemToToggle);itemToToggle.setStyle("top",this._submenu.getStyle("top")).setStyle("display","block").removeClass("rn_Hidden").addClass("rn_PanelContent").addClass("rn_Menu").addClass("rn_MobileNavigationMenu");this._button.set("innerHTML",RightNow.Interface.getMessage("BACK_LBL"));this._subMenuShowing=true;for(var i=0,alreadyInStack;i<this._contentStack.length;i++){if(this._contentStack[i].get("id")===itemToToggle.get("id")){alreadyInStack=true;break;}}
if(!alreadyInStack){this._contentStack.push(itemToToggle);}},_initMenu:function(){if(!this._initialized){this._panel=this.Y.Node.create("<div class='rn_Panel rn_Hidden'></div>");this._panel.appendChild(this._submenu);this._submenu.setStyle("display","block").removeClass("rn_Hidden").addClass("rn_PanelContent").addClass("rn_Menu").addClass("rn_MobileNavigationMenu");this.Y.one(document.body).get("firstChild").insert(this._panel,"before");var parentMenuAltHtml="<span class='rn_ParentMenuAlt'> "+this.data.attrs.label_parent_menu_alt+"</span>";this._submenu.all("ul.rn_Submenu").each(function(subMenu){subMenu.previous().append(parentMenuAltHtml).on("click",this._toggleMenu,this,subMenu);},this);this._contentStack=[];var firstInput=this._submenu.one("input");if(firstInput&&firstInput.focus){this._firstInput=firstInput;}
this._initialized=true;}}});
RightNow.Widgets.MobileSimpleSearch=RightNow.Widgets.extend({constructor:function(){this._searchField=this.Y.one(this.baseSelector+"_SearchField");if(!this._searchField)return;if(this.data.attrs.label_hint){this._searchField.on("focus",this._onFocus,this);this._searchField.on("blur",this._onBlur,this);}
if(this.data.attrs.clear_text_icon_path){this._searchField.on("keyup",this._handleClearTextDisplay,this);this._searchField.on("blur",this._handleClearTextDisplay,this);}
this.Y.Event.attach("click",this._onSearch,this.baseSelector+"_Submit",this);},_onSearch:function(){var searchString=(this._searchField.get("value")===this.data.attrs.label_hint)?"":this._searchField.get("value");if(searchString!==""){searchString=RightNow.Url.addParameter(this.data.attrs.report_page_url,"kw",searchString);searchString=RightNow.Url.addParameter(searchString,"search",1);searchString=RightNow.Url.addParameter(searchString,"session",RightNow.Url.getSession());RightNow.Url.navigate(searchString);}},_onFocus:function(){if(this._searchField.get("value")===this.data.attrs.label_hint)
this._searchField.set("value","");},_onBlur:function(){if(this._searchField.get("value")==="")
this._searchField.set("value",this.data.attrs.label_hint);},_handleClearTextDisplay:function(event){if(!this._clearIcon){this._clearIcon=this.Y.one(this.baseSelector+"_Clear");this._clearIcon.on("click",function(){this._searchField.set("value","").focus();RightNow.UI.hide(this._clearIcon);this._showing=false;},this);this._showing=false;}
if(this._searchField.get("value")===""){RightNow.UI.hide(this._clearIcon);this._showing=false;}
else if(!this._showing){RightNow.UI.show(this._clearIcon);this._showing=true;}}});